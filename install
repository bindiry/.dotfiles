#!/bin/bash

# install Prezto
#zsh
#git clone --recursive https://github.com/sorin-ionescu/prezto.git "${ZDOTDIR:-$HOME}/.zprezto"
#setopt EXTENDED_GLOB
#for rcfile in "${ZDOTDIR:-$HOME}"/.zprezto/runcoms/^README.md(.N); do
  #ln -s "$rcfile" "${ZDOTDIR:-$HOME}/.${rcfile:t}"
#done
#chsh -s /bin/zsh

# link dotfiles
ln -s ~/.dotfiles/vim/.vimrc ~/.vimrc
ln -s ~/.dotfiles/.ctags ~/.ctags
ln -s ~/.dotfiles/.gemrc ~/.gemrc
mkdir -p ~/.aria2
ln -s ~/.dotfiles/.aria2/aria2.conf ~/.aria2/aria2.conf
ln -s ~/.dotfiles/dnsmasq.conf /usr/local/etc/dnsmasq.conf
sudo brew services start dnsmasq
# get rules from https://github.com/ranmocy/chnroutes
mkdir -p ~/scripts
git clone git@github.com:ranmocy/chnroutes.git
cd chnroutes && python chnroutes.py -p mac -t ipsec && cd ..
touch vpnreset && chmod +x vpnreset
cat >> vpnreset<<EOF
#!/bin/sh
sudo sh ~/scripts/phase1-down.sh
sudo sh ~/scripts/phase1-up.sh
exit
EOF

# .zshrc
cat >> ~/.zshrc<<EOF
alias ll='ls -al'
alias vi='vim'
alias grep='grep --color:auto'
alias cls='clear'

function start_lantern {
    export http_proxy=http://127.0.0.1:8787
    export https_proxy=$http_proxy
    export ftp_proxy=$http_proxy
    export rsync_proxy=$http_proxy
    export no_proxy="localhost,127.0.0.1,localaddress,.localdomain.com"
}

function stop_lantern {
    export http_proxy=
    export https_proxy=
    export ftp_proxy=
    export rsync_proxy=
    export no_proxy=
    sudo launchctl unload -w /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist
    sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.mDNSResponder.plist
    sudo killall -9 networkd
}

function start_aria2 {
  aria2c --conf-path="/Users/bindiry/.aria2/aria2.conf" -D
}
EOF

